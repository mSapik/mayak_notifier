# Mayak Notifier

Бот для проверки обновлений ленты новостей в МАЯК ДОНМ <https://ekis.moscow/>
и отправки уведомлений в Telegram.

Бот проверяет последние новости, отмечает новости и вложения как прочитанные.
Проверка по умолчанию выполняется каждые 30 секунд.

## Требования
  1. Токен от [МАЯКа](https://ekis.moscow/).
  1. Токен бота, полученный от [@BotFather](https://t.me/botfather).
  1. Идентификаторы чата администратора (для отправки ошибок бота) и пользователей (для отправки уведомлений).
     Можно получить от [@userinfobot](https://telegram.me/userinfobot) или самого этого бота командой `/start`.
  1. Для получения сообщений от бота Telegram (любого), пользователь должен начать с ним диалог.
     Для этого нужно найти бота в поиске или перейти по ссылке на него.

## Настройки
  1. Установить Python 3.9 (с другими версиями бот не проверялся)
  1. Клонировать и открыть каталог репозитория
  1. Установить зависимости `pip install -r requirements.txt`
  1. Переименовать файл `.env.example` в `.env`
  1. Отредактировать файл `.env`, заменив переменные на свои
      - `TOKEN`: токен МАЯКа
      - `BOT_TOKEN`: токен бота
      - `BOT_USERS_CHAT_ID`: идентификаторы чатов пользователей через запятую без пробелов
      - `BOT_ADMIN_CHAT_ID`: идентификатор чата админа
      - `ENTRY_FILE`: файл где будут храниться айди новостей


## Запуск
Из командной строки `python3 bot/bot.py`
Или через Docker:
  1. `sudo docker build -t mayak_notifier .`
  1. `sudo docker run -d  -v путь_к_файлу_.env:/bot --name mayak_notifier --restart=always mayak_notifier`


## Тестирование
Чтобы не ждать появления свежих новостей в личном кабинете, можно удалить файл `entrys.json`, и уведомления с последними новостями будут отправлены заново.
